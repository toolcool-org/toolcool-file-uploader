{
  "version": 3,
  "sources": ["../../src/plugins/simple-upload-plugin/index.ts"],
  "sourcesContent": ["import './styles.css';\nimport { IPlugin, IUploadData } from '../../core/plugins/plugin-declarations';\nimport { ISettings } from '../../core/settings';\n\ninterface IGridItems {\n  $box: HTMLElement;\n  file: File;\n}\n\nconst removeBtnSVG = `<svg \n  xmlns=\"http://www.w3.org/2000/svg\" \n  width=\"20\"\n  height=\"20\"\n  fill=\"none\" \n  stroke=\"currentColor\" \n  stroke-linecap=\"round\" \n  stroke-linejoin=\"round\" \n  stroke-width=\"1.5\" \n  viewBox=\"0 0 24 24\">\n  <path stroke=\"none\" d=\"M0 0h24v24H0z\"/>\n  <path d=\"M18 6 6 18M6 6l12 12\"/>\n</svg>`;\n\n/**\n * This plugin allows to upload one or more files of any MIME type.\n */\nconst tcfuSimpleUploadPlugin = (_settings: ISettings) : IPlugin => {\n\n  let uploadData: IUploadData | undefined = undefined;\n  let gridItems: IGridItems[] = [];\n  let $previewPanel: HTMLElement | undefined = undefined;\n  let $cancelButton: HTMLElement | undefined = undefined;\n  let $uploadBtn: HTMLElement | undefined = undefined;\n\n  const cancel = () => {\n    if(!uploadData) return;\n\n    uploadData.$uploadPanel?.classList.remove('hidden');\n    $previewPanel?.classList.add('hidden');\n\n    for(const gridItem of gridItems){\n      gridItem.$box.remove();\n    }\n\n    gridItems = [];\n\n    if(uploadData.$fileInput){\n      uploadData.$fileInput.value = '';\n    }\n  };\n\n  const upload = () => {\n    if(!uploadData) return;\n\n    if(_settings.uploadCallback && typeof _settings.uploadCallback === 'function'){\n      _settings.uploadCallback({\n        files: gridItems.map(item => item.file),\n      });\n    }\n  };\n\n  const removeFile = (evt: MouseEvent) => {\n    const $btn = evt.currentTarget as HTMLButtonElement;\n    const $box = $btn.parentElement;\n    if(!$box) return;\n\n    const foundIndex = gridItems.findIndex(gridItem => gridItem.$box === $box);\n    if(foundIndex === -1) return;\n\n    gridItems.splice(foundIndex, 1);\n    $box.remove();\n\n    if(gridItems.length <= 0){\n      cancel();\n    }\n  };\n\n  return {\n    id: 'SimpleUploadPlugin',\n    title: 'Simple Upload Plugin',\n\n    extensions: ['*'],\n    mimeTypes: ['*'],\n\n    upload: async (_uploadData: IUploadData) => {\n      uploadData = _uploadData;\n      $previewPanel = uploadData.$uploader.querySelector('[data-tc=\"preview-panel\"]') as HTMLElement;\n      if(!$previewPanel) return;\n\n      uploadData.$uploadPanel?.classList.add('hidden');\n      $previewPanel?.classList.remove('hidden');\n\n      $cancelButton = $previewPanel.querySelector('[data-tc=\"cancel-preview-btn\"]') as HTMLElement;\n      $cancelButton?.addEventListener('click', cancel);\n\n      $uploadBtn = $previewPanel.querySelector('[data-tc=\"upload-btn\"]') as HTMLElement;\n      $uploadBtn?.addEventListener('click', upload);\n\n      const $preview = $previewPanel.querySelector('[data-tc=\"preview\"]') as HTMLElement;\n\n      for(const file of uploadData.files){\n\n        const $box = document.createElement('div') as HTMLElement;\n        $box.classList.add('tcfu-file-box');\n\n        // create 'remove file' button --------------\n        const $removeFileBtn = document.createElement('button') as HTMLButtonElement;\n        $removeFileBtn.type = 'button';\n        $removeFileBtn.classList.add('tcfu-remove-btn');\n        $removeFileBtn.innerHTML = removeBtnSVG;\n        $removeFileBtn.addEventListener('click', removeFile);\n        $box.append($removeFileBtn);\n\n        // create 'file name' span -------------\n        const $span = document.createElement('span') as HTMLSpanElement;\n        $span.textContent = file.name;\n        $box.append($span);\n\n        gridItems.push({\n          $box,\n          file,\n        });\n        $preview?.append($box);\n      }\n\n      if(_settings.previewCallback && typeof _settings.previewCallback === 'function'){\n        _settings.previewCallback({\n          files: _uploadData.files,\n        });\n      }\n    },\n\n    destroy: () => {\n      for(const gridItem of gridItems){\n        gridItem.$box.remove();\n      }\n\n      gridItems = [];\n\n      $cancelButton?.removeEventListener('click', cancel);\n      $uploadBtn?.removeEventListener('click', upload);\n\n      uploadData = undefined;\n      $previewPanel = undefined;\n      $cancelButton = undefined;\n      $uploadBtn = undefined;\n    },\n  };\n};\n\ndeclare global {\n  interface Window {\n    tcfuSimpleUploadPlugin: typeof tcfuSimpleUploadPlugin\n  }\n}\n\nwindow.tcfuSimpleUploadPlugin = tcfuSimpleUploadPlugin;\n\nexport default tcfuSimpleUploadPlugin;"],
  "mappings": ";;;;;;;mNASA,IAAMA,EAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAiBfC,EAA0BC,GAAmC,CAEjE,IAAIC,EACAC,EAA0B,CAAC,EAC3BC,EACAC,EACAC,EAEEC,EAAS,IAAM,CAlCvB,IAAAC,EAmCI,GAAG,EAACN,EAEJ,EAAAM,EAAAN,EAAW,eAAX,MAAAM,EAAyB,UAAU,OAAO,UAC1CJ,GAAA,MAAAA,EAAe,UAAU,IAAI,UAE7B,QAAUK,KAAYN,EACpBM,EAAS,KAAK,OAAO,EAGvBN,EAAY,CAAC,EAEVD,EAAW,aACZA,EAAW,WAAW,MAAQ,IAElC,EAEMQ,EAAS,IAAM,CAChB,CAACR,GAEDD,EAAU,gBAAkB,OAAOA,EAAU,gBAAmB,YACjEA,EAAU,eAAe,CACvB,MAAOE,EAAU,IAAIQ,GAAQA,EAAK,IAAI,CACxC,CAAC,CAEL,EAEMC,EAAcC,GAAoB,CAEtC,IAAMC,EADOD,EAAI,cACC,cAClB,GAAG,CAACC,EAAM,OAEV,IAAMC,EAAaZ,EAAU,UAAUM,GAAYA,EAAS,OAASK,CAAI,EACtEC,IAAe,KAElBZ,EAAU,OAAOY,EAAY,CAAC,EAC9BD,EAAK,OAAO,EAETX,EAAU,QAAU,GACrBI,EAAO,EAEX,EAEA,MAAO,CACL,GAAI,qBACJ,MAAO,uBAEP,WAAY,CAAC,GAAG,EAChB,UAAW,CAAC,GAAG,EAEf,OAAeS,GAA6BC,EAAA,wBApFhD,IAAAT,EAuFM,GAFAN,EAAac,EACbZ,EAAgBF,EAAW,UAAU,cAAc,2BAA2B,EAC3E,CAACE,EAAe,QAEnBI,EAAAN,EAAW,eAAX,MAAAM,EAAyB,UAAU,IAAI,UACvCJ,GAAA,MAAAA,EAAe,UAAU,OAAO,UAEhCC,EAAgBD,EAAc,cAAc,gCAAgC,EAC5EC,GAAA,MAAAA,EAAe,iBAAiB,QAASE,GAEzCD,EAAaF,EAAc,cAAc,wBAAwB,EACjEE,GAAA,MAAAA,EAAY,iBAAiB,QAASI,GAEtC,IAAMQ,EAAWd,EAAc,cAAc,qBAAqB,EAElE,QAAUe,KAAQjB,EAAW,MAAM,CAEjC,IAAMY,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,UAAU,IAAI,eAAe,EAGlC,IAAMM,EAAiB,SAAS,cAAc,QAAQ,EACtDA,EAAe,KAAO,SACtBA,EAAe,UAAU,IAAI,iBAAiB,EAC9CA,EAAe,UAAYrB,EAC3BqB,EAAe,iBAAiB,QAASR,CAAU,EACnDE,EAAK,OAAOM,CAAc,EAG1B,IAAMC,EAAQ,SAAS,cAAc,MAAM,EAC3CA,EAAM,YAAcF,EAAK,KACzBL,EAAK,OAAOO,CAAK,EAEjBlB,EAAU,KAAK,CACb,KAAAW,EACA,KAAAK,CACF,CAAC,EACDD,GAAA,MAAAA,EAAU,OAAOJ,EACnB,CAEGb,EAAU,iBAAmB,OAAOA,EAAU,iBAAoB,YACnEA,EAAU,gBAAgB,CACxB,MAAOe,EAAY,KACrB,CAAC,CAEL,GAEA,QAAS,IAAM,CACb,QAAUP,KAAYN,EACpBM,EAAS,KAAK,OAAO,EAGvBN,EAAY,CAAC,EAEbE,GAAA,MAAAA,EAAe,oBAAoB,QAASE,GAC5CD,GAAA,MAAAA,EAAY,oBAAoB,QAASI,GAEzCR,EAAa,OACbE,EAAgB,OAChBC,EAAgB,OAChBC,EAAa,MACf,CACF,CACF,EAQA,OAAO,uBAAyBN,EAEhC,IAAOsB,EAAQtB",
  "names": ["removeBtnSVG", "tcfuSimpleUploadPlugin", "_settings", "uploadData", "gridItems", "$previewPanel", "$cancelButton", "$uploadBtn", "cancel", "_a", "gridItem", "upload", "item", "removeFile", "evt", "$box", "foundIndex", "_uploadData", "__async", "$preview", "file", "$removeFileBtn", "$span", "simple_upload_plugin_default"]
}
