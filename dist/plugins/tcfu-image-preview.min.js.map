{
  "version": 3,
  "sources": ["../../src/core/domain/math-provider.ts", "../../src/plugins/image-preview-plugin/index.ts"],
  "sourcesContent": ["// eslint-disable-next-line\nexport const isNumber = (input: any) => {\n  return !isNaN(parseFloat(input)) && isFinite(input);\n};\n", "import './styles.css';\nimport { IPlugin, IUploadData } from '../../core/plugins/plugin-declarations';\nimport { ISettings } from '../../core/settings';\nimport { isNumber } from '../../core/domain/math-provider';\n\nexport interface ILoadedImage {\n  $image: HTMLImageElement;\n  width: number;\n  height: number;\n}\n\nexport const loadImage = (file: File) => {\n  return new Promise<ILoadedImage>((resolve, reject) => {\n    const $image = new Image();\n\n    $image.crossOrigin = 'Anonymous';\n    $image.onerror = (err) => reject(err);\n\n    $image.onload = (evt) => {\n      const { width, height } = evt.target as HTMLImageElement;\n      resolve({\n        $image,\n        width,\n        height,\n      });\n    };\n\n    const reader = new FileReader();\n    reader.onerror = (err) => reject(err);\n    reader.onload = () => {\n      $image.src = reader.result as string;\n    };\n    reader.readAsDataURL(file);\n  });\n};\n\n/**\n * This plugin displays standard image formats in the preview panel.\n */\nconst tcfuImagePreviewPlugin = (_settings: ISettings) : IPlugin => {\n\n  let uploadData: IUploadData | undefined = undefined;\n  let img: ILoadedImage | undefined = undefined;\n  let $previewPanel: HTMLElement | undefined = undefined;\n  let $cancelButton: HTMLElement | undefined = undefined;\n  let $uploadBtn: HTMLElement | undefined = undefined;\n\n  const cancel = () => {\n    if(!uploadData) return;\n\n    uploadData.$uploadPanel?.classList.remove('hidden');\n    $previewPanel?.classList.add('hidden');\n\n    img?.$image.remove();\n    img = undefined;\n\n    if(uploadData.$fileInput){\n      uploadData.$fileInput.value = '';\n    }\n  };\n\n  const upload = () => {\n    if(!uploadData) return;\n\n    if(_settings.uploadCallback && typeof _settings.uploadCallback === 'function'){\n      _settings.uploadCallback({\n        files: uploadData.files,\n      });\n    }\n  };\n\n  return {\n    id: 'ImagePreviewPlugin',\n    title: 'Image Preview Plugin',\n\n    extensions: ['jpg', 'jpeg', 'png', 'apng', 'gif', 'avif', 'svg', 'webp'],\n    mimeTypes: [\n      'image/jpeg',\n      'image/png',\n      'image/apng',\n      'image/avif',\n      'image/svg+xml',\n      'image/webp',\n    ],\n\n    /**\n     * Check if the image is valid.\n     */\n    validate: async (_settings: ISettings, file: File) => {\n      try{\n        img = await loadImage(file);\n      }\n      catch (ex){\n        return {\n          isValid: false,\n          message: 'Invalid image.'\n        };\n      }\n\n      if(isNumber(_settings.maxWidth) && img.width > (_settings.maxWidth as number)){\n        return {\n          isValid: false,\n          message: `The image width should not be more than ${ _settings.maxWidth } pixels.`,\n        };\n      }\n\n      if(isNumber(_settings.maxHeight) && img.height > (_settings.maxHeight as number)){\n        return {\n          isValid: false,\n          message: `The image height should not be more than ${ _settings.maxHeight } pixels.`,\n        };\n      }\n\n      return {\n        isValid: true,\n        message: '',\n      };\n    },\n\n    upload: async (_uploadData: IUploadData) => {\n      uploadData = _uploadData;\n      $previewPanel = uploadData.$uploader.querySelector('[data-tc=\"preview-panel\"]') as HTMLElement;\n      if(!$previewPanel) return;\n\n      uploadData.$uploadPanel?.classList.add('hidden');\n      $previewPanel?.classList.remove('hidden');\n\n      $cancelButton = $previewPanel.querySelector('[data-tc=\"cancel-preview-btn\"]') as HTMLElement;\n      $cancelButton?.addEventListener('click', cancel);\n\n      $uploadBtn = $previewPanel.querySelector('[data-tc=\"upload-btn\"]') as HTMLElement;\n      $uploadBtn?.addEventListener('click', upload);\n\n      if(uploadData.files.length <= 0) return;\n\n      try{\n        img = await loadImage(uploadData.files[0]);\n      }\n      catch (ex){\n        console.error('Image is not valid:', ex);\n      }\n\n      if(!img) return;\n\n      const $preview = $previewPanel.querySelector('[data-tc=\"preview\"]') as HTMLElement;\n      $preview?.append(img.$image);\n\n      if(_settings.previewCallback && typeof _settings.previewCallback === 'function'){\n        _settings.previewCallback({\n          files: _uploadData.files,\n        });\n      }\n    },\n\n    destroy: () => {\n      try{\n        img?.$image?.remove();\n      }\n      catch(ex){\n        // error\n      }\n\n      $cancelButton?.removeEventListener('click', cancel);\n      $uploadBtn?.removeEventListener('click', upload);\n\n      uploadData = undefined;\n      img = undefined;\n      $previewPanel = undefined;\n      $cancelButton = undefined;\n      $uploadBtn = undefined;\n    },\n  };\n};\n\ndeclare global {\n  interface Window {\n    tcfuImagePreviewPlugin: typeof tcfuImagePreviewPlugin\n  }\n}\n\nwindow.tcfuImagePreviewPlugin = tcfuImagePreviewPlugin;\n\nexport default tcfuImagePreviewPlugin;"],
  "mappings": "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",
  "names": ["isNumber", "input", "loadImage", "file", "resolve", "reject", "$image", "err", "evt", "width", "height", "reader", "tcfuImagePreviewPlugin", "_settings", "uploadData", "img", "$previewPanel", "$cancelButton", "$uploadBtn", "cancel", "_a", "upload", "__async", "ex", "isNumber", "_uploadData", "$preview", "image_preview_plugin_default"]
}
