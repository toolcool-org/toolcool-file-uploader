/* 
Tool Cool File Uploader
Version: 0.0.1
Documentation: https://github.com/toolcool-org/toolcool-file-uploader
License:    
Author: Tool Cool, toolcool.org@gmail.com>                          
*/
(()=>{var g=(n,i,t)=>new Promise((e,r)=>{var o=a=>{try{l(t.next(a))}catch(m){r(m)}},s=a=>{try{l(t.throw(a))}catch(m){r(m)}},l=a=>a.done?e(a.value):Promise.resolve(a.value).then(o,s);l((t=t.apply(n,i)).next())});var w=n=>{let i=[];return{init:()=>{if(!!n.plugins)for(let s of n.plugins){let l=s(n);i.push(l),l.init&&typeof l.init=="function"&&l.init()}},upload:s=>{for(let l of i)l.upload&&typeof l.upload=="function"&&l.upload(s)},destroy:()=>{for(let s of i)s.destroy&&typeof s.destroy=="function"&&s.destroy()},getPlugins:()=>i}},h=w;var u=n=>n.slice((Math.max(0,n.lastIndexOf("."))||1/0)+1).trim().toLowerCase();var p=n=>!isNaN(parseFloat(n))&&isFinite(n);var D=(n,i)=>{for(let t of i)if(t.extensions.includes(n))return!0;return!1},C=(n,i)=>{for(let t of i)if(t.mimeTypes.includes(n))return!0;return!1},x=(n,i,t)=>g(void 0,null,function*(){if(!n.validationEnabled)return{isValid:!0,message:""};let e=u(i.name);if(!D(e,t))return{isValid:!1,message:`The '.${e}' file extension is not supported.`};if(!C(i.type,t))return{isValid:!1,message:`The '${i.type}' file MIME type is not supported.`};if(p(n.maxSizeInBytes)&&i.size>n.maxSizeInBytes)return{isValid:!1,message:`The maximum file size must not exceed ${n.maxSizeInBytes} bytes.`};for(let r of t){if(!r.validate||typeof r.validate!="function")continue;let o=yield r.validate(n,i);if(!o.isValid)return o}return{isValid:!0,message:""}});var y="is-dragover",M=(n,i)=>{let t=null,e=n.querySelector('[data-tc="upload-panel"]'),r=e==null?void 0:e.querySelector('input[type="file"]'),o=d=>{d.preventDefault(),d.stopPropagation()},s=d=>{d.preventDefault(),d.stopPropagation(),e==null||e.classList.remove(y)},l=d=>{d.preventDefault(),d.stopPropagation(),e==null||e.classList.add(y)},a=d=>g(void 0,null,function*(){if(s(d),!d||!d.dataTransfer||!d.dataTransfer.files||d.dataTransfer.files.length<0)return;let f=d.dataTransfer.files[0];yield m(f)}),m=d=>g(void 0,null,function*(){var v;let f=yield x(i,d,(v=t==null?void 0:t.getPlugins())!=null?v:[]);if(!f.isValid){alert(f.message);return}t==null||t.upload({file:d,$uploader:n,$uploadPanel:e})}),c=d=>g(void 0,null,function*(){let f=d.target;if(!f.files||f.files.length<=0)return;let v=f.files[0];yield m(v)});return t=h(i),t.init(),r==null||r.addEventListener("change",c),e==null||e.addEventListener("drag",o),e==null||e.addEventListener("dragstart",o),e==null||e.addEventListener("dragend",s),e==null||e.addEventListener("dragleave",s),e==null||e.addEventListener("dragover",l),e==null||e.addEventListener("dragenter",l),e==null||e.addEventListener("drop",a),{destroy:()=>{r==null||r.removeEventListener("change",c),e==null||e.removeEventListener("drag",o),e==null||e.removeEventListener("dragstart",o),e==null||e.removeEventListener("dragend",s),e==null||e.removeEventListener("dragleave",s),e==null||e.removeEventListener("dragover",l),e==null||e.removeEventListener("dragenter",l),e==null||e.removeEventListener("drop",a),t==null||t.destroy()}}},E=M;var L=n=>new Promise((i,t)=>{let e=new Image;e.crossOrigin="Anonymous",e.onerror=o=>t(o),e.onload=o=>{let{width:s,height:l}=o.target;i({$image:e,width:s,height:l})};let r=new FileReader;r.onerror=o=>t(o),r.onload=()=>{e.src=r.result},r.readAsDataURL(n)}),U=n=>{let i,t,e,r,o,s=()=>{var a;!i||((a=i.$uploadPanel)==null||a.classList.remove("hidden"),e==null||e.classList.add("hidden"),t==null||t.$image.remove(),t=void 0)},l=()=>{var a,m;!i||n.uploadCallback&&typeof n.uploadCallback=="function"&&n.uploadCallback({file:i.file,ext:u((m=(a=i.file)==null?void 0:a.name)!=null?m:"")})};return{id:"ImagePreviewPlugin",title:"Image Preview Plugin",extensions:["jpg","jpeg","png","apng","gif","avif","svg","webp"],mimeTypes:["image/jpeg","image/png","image/apng","image/avif","image/svg+xml","image/webp"],validate:(a,m)=>g(void 0,null,function*(){try{t=yield L(m)}catch(c){return{isValid:!1,message:"Invalid image."}}return p(a.maxWidth)&&t.width>a.maxWidth?{isValid:!1,message:`The image width should not be more than ${a.maxWidth} pixels.`}:p(a.maxHeight)&&t.height>a.maxHeight?{isValid:!1,message:`The image height should not be more than ${a.maxHeight} pixels.`}:{isValid:!0,message:""}}),upload:a=>g(void 0,null,function*(){var c,I,d;if(i=a,e=i.$uploader.querySelector('[data-tc="preview-panel"]'),!e)return;(c=i.$uploadPanel)==null||c.classList.add("hidden"),e==null||e.classList.remove("hidden"),r=e.querySelector('[data-tc="cancel-preview-btn"]'),r==null||r.addEventListener("click",s),o=e.querySelector('[data-tc="upload-btn"]'),o==null||o.addEventListener("click",l);try{t=yield L(i.file)}catch(f){console.error("Image is not valid:",f)}if(!t)return;let m=e.querySelector('[data-tc="preview"]');m==null||m.append(t.$image),n.previewCallback&&typeof n.previewCallback=="function"&&n.previewCallback({file:a.file,ext:u((d=(I=a.file)==null?void 0:I.name)!=null?d:"")})}),destroy:()=>{var a;try{(a=t==null?void 0:t.$image)==null||a.remove()}catch(m){}r==null||r.removeEventListener("click",s),o==null||o.removeEventListener("click",l),i=void 0,t=void 0,e=void 0,r=void 0,o=void 0}}},b=U;var S={path:"",plugins:[b],validationEnabled:!0};var T=n=>{let i,t,e=o=>{let s=Object.assign(S,o);if(t=document.querySelector(s.path),!t){console.error("File uploader error: the path property is not defined.");return}i=E(t,s)},r=()=>{i==null||i.destroy(),i=void 0,t=void 0};return e(n),{destroy:r}},ne=T;window.tcFileUploader=T;})();
//# sourceMappingURL=toolcool-file-uploader.min.js.map
