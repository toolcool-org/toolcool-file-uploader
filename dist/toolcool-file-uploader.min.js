/* 
Tool Cool File Uploader
Version: 0.0.1
Documentation: https://github.com/toolcool-org/toolcool-file-uploader
License:    
Author: Tool Cool, toolcool.org@gmail.com>                          
*/
(()=>{var f=(r,i,t)=>new Promise((e,n)=>{var a=o=>{try{d(t.next(o))}catch(m){n(m)}},s=o=>{try{d(t.throw(o))}catch(m){n(m)}},d=o=>o.done?e(o.value):Promise.resolve(o.value).then(a,s);d((t=t.apply(r,i)).next())});var D=r=>{let i=[];return{init:()=>{if(!!r.plugins)for(let s of r.plugins){let d=s(r);i.push(d),d.init&&typeof d.init=="function"&&d.init()}},upload:s=>{for(let d of i)d.upload&&typeof d.upload=="function"&&d.upload(s)},destroy:()=>{for(let s of i)s.destroy&&typeof s.destroy=="function"&&s.destroy()},getPlugins:()=>i}},I=D;var y=r=>r.slice((Math.max(0,r.lastIndexOf("."))||1/0)+1).trim().toLowerCase();var c=r=>!isNaN(parseFloat(r))&&isFinite(r);var C=(r,i)=>{for(let t of i)if(t.extensions.includes(r))return!0;return!1},M=(r,i)=>{for(let t of i)if(t.mimeTypes.includes(r))return!0;return!1},U=(r,i,t)=>f(void 0,null,function*(){let e=y(i.name);if(!C(e,t))return{isValid:!1,message:`The '.${e}' file extension is not supported.`};if(!M(i.type,t))return{isValid:!1,message:`The '${i.type}' file MIME type is not supported.`};if(c(r.maxSizeInBytes)&&i.size>r.maxSizeInBytes)return{isValid:!1,message:`The maximum file size must not exceed ${r.maxSizeInBytes} bytes.`};for(let n of t){if(!n.validate||typeof n.validate!="function")continue;let a=yield n.validate(r,i);if(!a.isValid)return a}return{isValid:!0,message:""}}),h=(r,i,t)=>f(void 0,null,function*(){if(!r.validationEnabled)return{isValid:!0,message:""};for(let e of i){let n=yield U(r,e,t);if(!n.isValid)return n}return{isValid:!0,message:""}});var x="is-dragover",F=(r,i)=>{let t=null,e=r.querySelector('[data-tc="upload-panel"]'),n=e==null?void 0:e.querySelector('input[type="file"]'),a=l=>{l.preventDefault(),l.stopPropagation()},s=l=>{l.preventDefault(),l.stopPropagation(),e==null||e.classList.remove(x)},d=l=>{l.preventDefault(),l.stopPropagation(),e==null||e.classList.add(x)},o=l=>f(void 0,null,function*(){s(l),!(!l||!l.dataTransfer||!l.dataTransfer.files||l.dataTransfer.files.length<0)&&(yield m(Array.from(l.dataTransfer.files)))}),m=l=>f(void 0,null,function*(){var v;let u=yield h(i,l,(v=t==null?void 0:t.getPlugins())!=null?v:[]);if(!u.isValid){alert(u.message);return}t==null||t.upload({files:l,$uploader:r,$uploadPanel:e})}),g=l=>f(void 0,null,function*(){let u=l.target;!u.files||u.files.length<=0||(yield m(Array.from(u.files)))});return t=I(i),t.init(),n==null||n.addEventListener("change",g),e==null||e.addEventListener("drag",a),e==null||e.addEventListener("dragstart",a),e==null||e.addEventListener("dragend",s),e==null||e.addEventListener("dragleave",s),e==null||e.addEventListener("dragover",d),e==null||e.addEventListener("dragenter",d),e==null||e.addEventListener("drop",o),{destroy:()=>{n==null||n.removeEventListener("change",g),e==null||e.removeEventListener("drag",a),e==null||e.removeEventListener("dragstart",a),e==null||e.removeEventListener("dragend",s),e==null||e.removeEventListener("dragleave",s),e==null||e.removeEventListener("dragover",d),e==null||e.removeEventListener("dragenter",d),e==null||e.removeEventListener("drop",o),t==null||t.destroy()}}},L=F;var E=r=>new Promise((i,t)=>{let e=new Image;e.crossOrigin="Anonymous",e.onerror=a=>t(a),e.onload=a=>{let{width:s,height:d}=a.target;i({$image:e,width:s,height:d})};let n=new FileReader;n.onerror=a=>t(a),n.onload=()=>{e.src=n.result},n.readAsDataURL(r)}),b=r=>{let i,t,e,n,a,s=()=>{var o;!i||((o=i.$uploadPanel)==null||o.classList.remove("hidden"),e==null||e.classList.add("hidden"),t==null||t.$image.remove(),t=void 0)},d=()=>{!i||r.uploadCallback&&typeof r.uploadCallback=="function"&&r.uploadCallback({files:i.files})};return{id:"ImagePreviewPlugin",title:"Image Preview Plugin",extensions:["jpg","jpeg","png","apng","gif","avif","svg","webp"],mimeTypes:["image/jpeg","image/png","image/apng","image/avif","image/svg+xml","image/webp"],validate:(o,m)=>f(void 0,null,function*(){try{t=yield E(m)}catch(g){return{isValid:!1,message:"Invalid image."}}return c(o.maxWidth)&&t.width>o.maxWidth?{isValid:!1,message:`The image width should not be more than ${o.maxWidth} pixels.`}:c(o.maxHeight)&&t.height>o.maxHeight?{isValid:!1,message:`The image height should not be more than ${o.maxHeight} pixels.`}:{isValid:!0,message:""}}),upload:o=>f(void 0,null,function*(){var g;if(i=o,e=i.$uploader.querySelector('[data-tc="preview-panel"]'),!e||((g=i.$uploadPanel)==null||g.classList.add("hidden"),e==null||e.classList.remove("hidden"),n=e.querySelector('[data-tc="cancel-preview-btn"]'),n==null||n.addEventListener("click",s),a=e.querySelector('[data-tc="upload-btn"]'),a==null||a.addEventListener("click",d),i.files.length<=0))return;try{t=yield E(i.files[0])}catch(p){console.error("Image is not valid:",p)}if(!t)return;let m=e.querySelector('[data-tc="preview"]');m==null||m.append(t.$image),r.previewCallback&&typeof r.previewCallback=="function"&&r.previewCallback({files:o.files})}),destroy:()=>{var o;try{(o=t==null?void 0:t.$image)==null||o.remove()}catch(m){}n==null||n.removeEventListener("click",s),a==null||a.removeEventListener("click",d),i=void 0,t=void 0,e=void 0,n=void 0,a=void 0}}};window.tcfuImagePreviewPlugin=b;var w=b;var S={path:"",plugins:[w],validationEnabled:!0};var T=r=>{let i,t,e=a=>{let s=Object.assign(S,a);if(t=document.querySelector(s.path),!t){console.error("File uploader error: the path property is not defined.");return}i=L(t,s)},n=()=>{i==null||i.destroy(),i=void 0,t=void 0};return e(r),{destroy:n}},re=T;window.tcFileUploader=T;})();
//# sourceMappingURL=toolcool-file-uploader.min.js.map
