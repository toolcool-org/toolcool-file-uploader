/* 
Tool Cool File Uploader
Version: 0.0.1
Documentation: https://github.com/toolcool-org/toolcool-file-uploader
License:    
Author: Tool Cool, toolcool.org@gmail.com>                          
*/
(()=>{var f=(r,n,t)=>new Promise((e,i)=>{var o=a=>{try{l(t.next(a))}catch(g){i(g)}},s=a=>{try{l(t.throw(a))}catch(g){i(g)}},l=a=>a.done?e(a.value):Promise.resolve(a.value).then(o,s);l((t=t.apply(r,n)).next())});var w=r=>{let n=[];return{init:()=>{if(!!r.plugins)for(let s of r.plugins){let l=s(r);n.push(l),l.init&&typeof l.init=="function"&&l.init()}},upload:s=>{for(let l of n)l.upload&&typeof l.upload=="function"&&l.upload(s)},destroy:()=>{for(let s of n)s.destroy&&typeof s.destroy=="function"&&s.destroy()},getPlugins:()=>n}},I=w;var u=r=>r.slice((Math.max(0,r.lastIndexOf("."))||1/0)+1).trim().toLowerCase();var S=(r,n)=>{for(let t of n)if(t.extensions.includes(r))return!0;return!1},D=(r,n)=>{for(let t of n)if(t.mimeTypes.includes(r))return!0;return!1},y=(r,n,t)=>f(void 0,null,function*(){if(!r.validationEnabled)return{isValid:!0,message:""};let e=u(n.name);if(!S(e,t))return{isValid:!1,message:`The '.${e}' file extension is not supported.`};if(!D(n.type,t))return{isValid:!1,message:`The '${n.type}' file MIME type is not supported.`};for(let i of t){if(!i.validate||typeof i.validate!="function")continue;let o=yield i.validate(r,n);if(!o.isValid)return o}return{isValid:!0,message:""}});var E="is-dragover",C=(r,n)=>{let t=null,e=r.querySelector('[data-tc="upload-panel"]'),i=e==null?void 0:e.querySelector('input[type="file"]'),o=d=>{d.preventDefault(),d.stopPropagation()},s=d=>{d.preventDefault(),d.stopPropagation(),e==null||e.classList.remove(E)},l=d=>{d.preventDefault(),d.stopPropagation(),e==null||e.classList.add(E)},a=d=>f(void 0,null,function*(){if(s(d),!d||!d.dataTransfer||!d.dataTransfer.files||d.dataTransfer.files.length<0)return;let c=d.dataTransfer.files[0];yield g(c)}),g=d=>f(void 0,null,function*(){var p;let c=yield y(n,d,(p=t==null?void 0:t.getPlugins())!=null?p:[]);if(!c.isValid){alert(c.message);return}t==null||t.upload({file:d,$uploader:r,$uploadPanel:e})}),m=d=>f(void 0,null,function*(){let c=d.target;if(!c.files||c.files.length<=0)return;let p=c.files[0];yield g(p)});return t=I(n),t.init(),i==null||i.addEventListener("change",m),e==null||e.addEventListener("drag",o),e==null||e.addEventListener("dragstart",o),e==null||e.addEventListener("dragend",s),e==null||e.addEventListener("dragleave",s),e==null||e.addEventListener("dragover",l),e==null||e.addEventListener("dragenter",l),e==null||e.addEventListener("drop",a),{destroy:()=>{i==null||i.removeEventListener("change",m),e==null||e.removeEventListener("drag",o),e==null||e.removeEventListener("dragstart",o),e==null||e.removeEventListener("dragend",s),e==null||e.removeEventListener("dragleave",s),e==null||e.removeEventListener("dragover",l),e==null||e.removeEventListener("dragenter",l),e==null||e.removeEventListener("drop",a),t==null||t.destroy()}}},L=C;var x=r=>new Promise((n,t)=>{let e=new Image;e.crossOrigin="Anonymous",e.onerror=o=>t(o),e.onload=o=>{let{width:s,height:l}=o.target;n({$image:e,width:s,height:l})};let i=new FileReader;i.onerror=o=>t(o),i.onload=()=>{e.src=i.result},i.readAsDataURL(r)}),M=r=>{let n,t,e,i,o,s=()=>{var a;!n||((a=n.$uploadPanel)==null||a.classList.remove("hidden"),e==null||e.classList.add("hidden"),t==null||t.$image.remove(),t=void 0)},l=()=>{var a,g;!n||r.uploadCallback&&typeof r.uploadCallback=="function"&&r.uploadCallback({file:n.file,ext:u((g=(a=n.file)==null?void 0:a.name)!=null?g:"")})};return{id:"ImagePreviewPlugin",title:"Image Preview Plugin",extensions:["jpg","jpeg","png","apng","gif","avif","svg","webp"],mimeTypes:["image/jpeg","image/png","image/apng","image/avif","image/svg+xml","image/webp"],validate:(a,g)=>f(void 0,null,function*(){try{yield x(g)}catch(m){return{isValid:!1,message:"Invalid image."}}return{isValid:!0,message:""}}),upload:a=>f(void 0,null,function*(){var m,v,d;if(n=a,e=n.$uploader.querySelector('[data-tc="preview-panel"]'),!e)return;(m=n.$uploadPanel)==null||m.classList.add("hidden"),e==null||e.classList.remove("hidden"),i=e.querySelector('[data-tc="cancel-preview-btn"]'),i==null||i.addEventListener("click",s),o=e.querySelector('[data-tc="upload-btn"]'),o==null||o.addEventListener("click",l);try{t=yield x(n.file)}catch(c){console.error("Image is not valid:",c)}if(!t)return;let g=e.querySelector('[data-tc="preview"]');g==null||g.append(t.$image),r.previewCallback&&typeof r.previewCallback=="function"&&r.previewCallback({file:a.file,ext:u((d=(v=a.file)==null?void 0:v.name)!=null?d:"")})}),destroy:()=>{var a;try{(a=t==null?void 0:t.$image)==null||a.remove()}catch(g){}i==null||i.removeEventListener("click",s),o==null||o.removeEventListener("click",l),n=void 0,t=void 0,e=void 0,i=void 0,o=void 0}}},h=M;var T={path:"",plugins:[h],validationEnabled:!0};var b=r=>{let n,t,e=o=>{let s=Object.assign(T,o);if(t=document.querySelector(s.path),!t){console.error("File uploader error: the path property is not defined.");return}n=L(t,s)},i=()=>{n==null||n.destroy(),n=void 0,t=void 0};return e(r),{destroy:i}},$=b;window.tcFileUploader=b;})();
//# sourceMappingURL=toolcool-file-uploader.min.js.map
